{{- define "bigbang.defaults.istio-gateway" -}}
gateways:
  public:
    gateway:
      servers:
      - hosts:
        - '*.{{ .Values.domain }}'
        port:
          name: http
          number: 8080
          protocol: HTTP
        tls:
          httpsRedirect: true
      - hosts:
        - '*.{{ .Values.domain }}'
        port:
          name: https
          number: 8443
          protocol: HTTPS
        tls:
          credentialName: public-cert
          mode: SIMPLE

    upstream:
      serviceAccount:
        create: true
        name: public-ingressgateway-ingressgateway-service-account

      imagePullPolicy: {{ .Values.imagePullPolicy }}

      {{- if ( include "imagePullSecret" . ) }}
      imagePullSecrets:
        - name: private-registry
      {{- else }}
      imagePullSecrets: []
      {{- end }}

      labels:
        istio: ingressgateway

  passthrough:
    gateway:
      servers:
      - hosts:
        - '*.{{ .Values.domain }}'
        port:
          name: http
          number: 8080
          protocol: HTTP
        tls:
          httpsRedirect: true
      - hosts:
        - '*.{{ .Values.domain }}'
        port:
          name: https
          number: 8443
          protocol: HTTPS
        tls:
          mode: PASSTHROUGH

    upstream:
      serviceAccount:
        create: true
        name: passthrough-ingressgateway-ingressgateway-service-account

      imagePullPolicy: {{ .Values.imagePullPolicy }}

      {{- if ( include "imagePullSecret" . ) }}
      imagePullSecrets:
        - name: private-registry
      {{- end }}

      labels:
        istio: ingressgateway
{{- end }}