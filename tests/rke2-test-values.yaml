# Values overrides for RKE2 pipelines
# These values inherit and override values from tests/test-values.yaml
networkPolicies:
  controlPlaneCidr: 10.0.0.0/8

istio:
  values:
    values:
      global: 
        proxy:
          resources:
            requests:
              cpu: 100m
              memory: 256Mi
            limits:
              cpu: null
              memory: 256Mi

gatekeeper:
  values:
    bbtests:
      cypress:
        artifacts: false
    replicas: 1
    controllerManager:
      resources:
        limits:
          cpu: null
          memory: 512Mi
        requests:
          cpu: 175m
          memory: 512Mi

kyverno:
  values:
    bbtests:
      cypress:
        artifacts: false
    networkPolicies:
      externalRegistries:
        allowEgress: true
    replicaCount: 3
    resources:
      limits:
        cpu: null
        memory: 384Mi
      requests:
        cpu: 500m
        memory: 384Mi

elasticsearchKibana:
  values:
    bbtests:
      cypress:
        artifacts: false
    elasticsearch:
      master:
        count: 1
        persistence:
          size: 256Mi
        resources:
          requests:
            cpu: .5
            memory: 512Mi
          limits:
            cpu: null
            memory: 512Mi
      data:
        count: 2
        persistence:
          size: 256Mi
        resources:
          requests:
            cpu: .5
            memory: 512Mi
          limits:
            cpu: null
            memory: 512Mi

loki:
  values:
    global:
      dnsService: rke2-coredns-rke2-coredns  
    bbtests:
      cypress:
        artifacts: false
    loki-simple-scalable:
      write:
        resources:
          limits: null
      read:
        resources:
          limits: null

tempo:
  values:
    bbtests:
      cypress:
        artifacts: false
    tempo:
      resources:
        limits:
          cpu: null
          memory: 1024Mi
        requests:
          cpu: 500m
          memory: 1024Mi
    persistence:
      size: 5Gi
    tempoQuery:
      resources:
        limits:
          cpu: null
          memory: 256Mi
        requests:
          cpu: 300m
          memory: 256Mi
    opentelemetryCollector:
      resources:
        limits:
          cpu: null
          memory: 256Mi
        requests:
          cpu: 300m
          memory: 256Mi

monitoring:
  values:
    bbtests:
      cypress:
        artifacts: false
    prometheus:
      prometheusSpec:
        additionalScrapeConfigs: []
        podMetadata:
          annotations:
            vault.hashicorp.com/agent-inject: "false"
            vault.hashicorp.com/agent-init-first: "false"
            vault.hashicorp.com/agent-inject-token: "false"
        resources:
          requests:
            cpu: 300m
            memory: 5Gi
          limits:
            cpu: null
            memory: 5Gi
    kube-state-metrics:
      resources:
        requests:
          cpu: 100m
          memory: 128Mi
        limits:
          cpu: null
          memory: 128Mi
    prometheus-node-exporter:
      resources:
        requests:
          cpu: 200m
          memory: 50Mi
        limits:
          cpu: null
          memory: 50Mi
    grafana:
      downloadDashboards:
        resources:
          limits:
            cpu: null
            memory: 20Mi
          requests:
            cpu: 20m
            memory: 20Mi

twistlock:
  values:
    bbtests:
      cypress:
        artifacts: false
    console:
      persistence:
        size: 5Gi

jaeger:
  values:
    bbtests:
      cypress:
        artifacts: false

kiali:
  values:
    bbtests:
      cypress:
        artifacts: false

grafana:
  values:
    bbtests:
      cypress:
        artifacts: false

bbctl:
  values:
    bbtests:
      cypress:
        artifacts: false

# Addons are toggled based on labels in CI
addons:
  mimir:
    values:
      bbtests:
        cypress:
          artifacts: false
      mimir-distributed:
        global:
          dnsService: rke2-coredns-rke2-coredns
  argocd:
    values:
      bbtests:
        cypress:
          artifacts: false
      controller:
        resources:
          requests:
            cpu: 500m
            memory: 2Gi
          limits:
            cpu: null
            memory: 2Gi
      dex:
        resources:
          requests:
            cpu: 10m
            memory: 128Mi
          limits:
            cpu: null
            memory: 128Mi
      redis-bb:
        master:
          persistence:
            size: 512Mi
        replica:
          persistence:
            size: 512Mi
      redis:
        resources:
          requests:
            cpu: 50m
            memory: 256Mi
          limits:
            cpu: null
            memory: 256Mi
      server:
        resources:
          requests:
            cpu: 20m
            memory: 128Mi
          limits:
            cpu: null
            memory: 128Mi
      repoServer:
        resources:
          requests:
            cpu: 100m
            memory: 256Mi
          limits:
            cpu: null
            memory: 256Mi

  authservice:
    values:
      bbtests:
        cypress:
          artifacts: false
      resources:
        requests:
          cpu: 100m
          memory: 256Mi
        limits:
          cpu: null
          memory: 256Mi
      redis:
        master:
          persistence:
            size: 256Mi
        replica:
          persistence:
            size: 256Mi

  gitlab:
    flux:
      timeout: 30m
    values:
      bbtests:
        cypress:
          artifacts: false
      gitlab-runner:
        resources:
          requests:
            cpu: 20m
            memory: 128Mi
          limits:
            cpu: null
            memory: 128Mi
      gitlab:
        gitaly:
          persistence:
            size: 256Mi
          resources:
            ## values raised to help pass CI after default values for gitaly are fixed then can revert to original request.
            #requests:
            #  cpu: 50m
            #limits: null
            requests:
              cpu: 400m
              memory: 600Mi
            limits:
              cpu: null
              memory: 600Mi
        shared-secrets:
          resources:
            requests:
              cpu: 30m
              memory: 128Mi
            limits:
              cpu: null
              memory: 128Mi
        migrations:
          resources:
            requests:
              cpu: 30m
              memory: 128Mi
            limits:
              cpu: null
              memory: 128Mi
        toolbox:
          persistence:
            size: 256Mi
          resources:
            requests:
              cpu: 20m
              memory: 128Mi
            limits:
              cpu: null
              memory: 128Mi
      postgresql:
        persistence:
          size: 256Mi
        metrics:
          resources:
            requests:
              cpu: 50m
              memory: 128Mi
            limits:
              cpu: null
              memory: 128Mi
      minio:
        persistence:
          size: 256Mi
        resources:
          requests:
            cpu: 100m
            memory: 256Mi
          limits:
            cpu: null
            memory: 256Mi
      redis:
        master:
          persistence:
            size: 256Mi
        slave:
          persistence:
            size: 256Mi

  gitlabRunner:
    values:
      bbtests:
        cypress:
          artifacts: false
      resources:
        requests:
          memory: 128Mi
          cpu: 100m
        limits:
          memory: 128Mi
          cpu: null

  anchore:
    values:
      bbtests:
        cypress:
          artifacts: false
      ensureDbJobs:
        resources:
          requests:
            cpu: 100m
            memory: 256Mi
          limits:
            cpu: null
            memory: 256Mi
      sso:
        resources:
          requests:
            cpu: 100m
            memory: 256Mi
          limits:
            cpu: null
            memory: 256Mi
      postgresql:
        persistence:
          size: 256Mi
        resources:
          requests:
            cpu: 100m
            memory: 256Mi
          limits:
            cpu: null
            memory: 256Mi
        metrics:
          resources:
            requests:
              cpu: 100m
              memory: 256Mi
            limits:
              cpu: null
              memory: 256Mi
      anchoreAnalyzer:
        resources:
          requests:
            cpu: 200m
            memory: 512Mi
          limits:
            cpu: null
            memory: 512Mi
      anchoreApi:
        resources:
          requests:
            cpu: 200m
            memory: 512Mi
          limits:
            cpu: null
            memory: 512Mi
      anchoreCatalog:
        resources:
          requests:
            cpu: 200m
            memory: 512Mi
          limits:
            cpu: null
            memory: 512Mi
      anchorePolicyEngine:
        resources:
          requests:
            cpu: 200m
            memory: 512Mi
          limits:
            cpu: null
            memory: 512Mi
      anchoreSimpleQueue:
        resources:
          requests:
            cpu: 200m
            memory: 512Mi
          limits:
            cpu: null
            memory: 512Mi
      anchoreEngineUpgradeJob:
        resources:
          requests:
            cpu: 200m
            memory: 512Mi
          limits:
            cpu: null
            memory: 512Mi
      anchore-feeds-db:
        resources:
          requests:
            cpu: 100m
            memory: 256Mi
          limits:
            cpu: null
            memory: 256Mi
        metrics:
          resources:
            requests:
              cpu: 100m
              memory: 256Mi
            limits:
              cpu: null
              memory: 256Mi
      anchoreEnterpriseFeeds:
        resources:
          requests:
            cpu: 200m
            memory: 512Mi
          limits:
            cpu: null
            memory: 512Mi
      anchoreEnterpriseFeedsUpgradeJob:
        resources:
          requests:
            cpu: 200m
            memory: 512Mi
          limits:
            cpu: null
            memory: 512Mi
      anchoreEnterpriseRbac:
        authResources:
          requests:
            cpu: 200m
            memory: 512Mi
          limits:
            cpu: null
            memory: 512Mi
        managerResources:
          requests:
            cpu: 200m
            memory: 512Mi
          limits:
            cpu: null
            memory: 512Mi
      anchoreEnterpriseReports:
        resources:
          requests:
            cpu: 200m
            memory: 512Mi
          limits:
            cpu: null
            memory: 512Mi
      anchoreEnterpriseNotifications:
        resources:
          requests:
            cpu: 200m
            memory: 512Mi
          limits:
            cpu: null
            memory: 512Mi
      anchoreEntperpiseUi:
        resources:
          requests:
            cpu: 200m
            memory: 512Mi
          limits:
            cpu: null
            memory: 512Mi
      anchoreEnterpriseEngineUpgradeJob:
        resources:
          requests:
            cpu: 200m
            memory: 512Mi
          limits:
            cpu: null
            memory: 512Mi
    
  sonarqube:
    values:
      bbtests:
        cypress:
          artifacts: false
      resources:
        requests:
          cpu: 200m
          memory: 512Mi
        limits:
          cpu: null
          memory: 512Mi
      persistence:
        size: 5Gi
      postgresql:
        persistence:
          size: 256Mi
        resources:
          requests:
            cpu: 100m
            memory: 200Mi
          limits:
            cpu: null
            memory: 200Mi

  minio:
    values:
      bbtests:
        cypress:
          artifacts: false
      tenant:
        pools:
        - name: pool-0
          servers: 3
          volumesPerServer: 4
          size: 256Mi
          resources:
            requests:
              cpu: 250m
              memory: 512Mi
            limits:
              cpu: null
              memory: 512Mi
          securityContext:
            runAsUser: 1001
            runAsGroup: 1001
            fsGroup: 1001
            runAsNonRoot: true
          containerSecurityContext:
            runAsUser: 1001
            runAsGroup: 1001
            runAsNonRoot: true
            capabilities:
              drop:
              - ALL
  mattermost:
    values:
      bbtests:
        cypress:
          artifacts: false
  nexusRepositoryManager:
    values:
      bbtests:
        cypress:
          artifacts: false
      persistence:
        # Do NOT set this below 5Gi, nexus will fail to boot
        storageSize: 5Gi
      nexus:
        resources:
          requests:
            cpu: 100m
            memory: 1500Mi
          limits:
            cpu: null
            memory: 1500Mi
  
  keycloak:
    values:
      bbtests:
        cypress:
          artifacts: false
      resources:
        requests:
          cpu: 100m
          memory: 256Mi
        limits:
          cpu: null
          memory: 256Mi

  harbor:
    values:
      bbtests:
        cypress:
          artifacts: false

  fortify:
    values:
      bbtests:
        cypress:
          artifacts: false

  minioOperator:
    values:
      bbtests:
        cypress:
          artifacts: false